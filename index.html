<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Muttqt by tgray</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Muttqt</h1>
          <h2>mutt query tool</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/tgray/muttqt/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/tgray/muttqt/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/tgray/muttqt" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>muttqt</h1>

<p><code>muttqt</code> is a command line program to facilitate querying various email address
storage solutions from mutt.</p>

<h2>Overview</h2>

<p><code>muttqt</code> is designed to be called by the <a href="http://www.mutt.org">mutt</a> <a href="http://dev.mutt.org/doc/manual.html#query">query_command</a> to provide
a single entry for multiple email address storage locations.  </p>

<p><code>muttqt</code> currently interfaces with mutt aliases files, a database of email
addresses that you have sent emails too, as well as functionality to communicate
with other external tools, such as:</p>

<ul>
<li>
<a href="https://github.com/tgray/contacts">contacts</a> - a small tool that talks to the Mac OS X Address Book</li>
<li>
<a href="https://pypi.python.org/pypi/goobook/">goobook</a> - a Python program that accesses your Google contacts</li>
<li>
<a href="http://www.djcbsoftware.nl/code/mu/">mu</a> - mu's cfind command, part of the maildir indexing tool</li>
</ul><p><code>muttqt</code> requires <code>python</code> and <code>sqlite3</code>.  It has been tested with <code>python</code> 2.7,
but should work with earlier versions.</p>

<h2>Advantages over lbdb</h2>

<ul>
<li>Actively supported.</li>
<li>Easy to extend.  As long as the external tools provide their output in the
proper format, no code changes to <code>muttqt</code> need to be made.</li>
<li>Stores email addresses you have sent messages to in either SQL or a flat text
file (lbdb-compatible).</li>
<li>UTF-8 support.<br>
</li>
</ul><h2>Installing</h2>

<p>One can copy the <code>muttqt</code> python file to your path to install.  Alternately, it
can be installed by running</p>

<pre><code>make
make install
</code></pre>

<p>If you would like to install it in a location other than <em>/usr/local</em>, use the
prefix setting when running <code>make install</code> like so:</p>

<pre><code>make prefix=/path/to/install install
</code></pre>

<p>On OS X, you will probably also want to install the <code>contacts</code> program.  It can
be installed easily by using <a href="https://github.com/mxcl/homebrew">homebrew</a>:</p>

<pre><code>brew install https://raw.github.com/tgray/homebrew-tgbrew/master/contacts.rb
</code></pre>

<h2>Configuring</h2>

<p>muttqt's configuration and data files are stored in the <code>~/.muttqt</code> directory.
The configuration is called <code>muttqt.conf</code>.  To generate a default configuration
file, run <code>muttqt --write-config</code>.</p>

<p>muttqt is setup to utilise an Sqlite3 database for it's sent email address
storage.  This can be changed to a flat text file that is lbdb compatible by
changing the 'format' parameter in the 'sent' section to 'text'.</p>

<h2>Example Usage</h2>

<p>This returns all matches for <em>somename</em> from all of your configured data sources:</p>

<pre><code>muttqt -q somename
</code></pre>

<p>The following usage will store any email address in the To, CC, or BCC headers
and store them in the sent address data file.</p>

<pre><code>cat email.txt | muttqt -f
</code></pre>

<p>To automate this harvesting of emails, see the section "Setting up sent email
integration".</p>

<h2>Setting up mutt</h2>

<h3>Querying</h3>

<p>To configure mutt to use muttqt, set the following in your muttrc file:</p>

<pre><code>set query_command="/usr/local/bin/muttqt -q '%s'"
</code></pre>

<h3>Setting up sent email integration</h3>

<p>The <code>muttqt -f</code> command provides a method of searching the To, CC, or BCC
headers of input data.  An easy way to automate address capture is to set the
mutt <a href="http://www.mutt.org/doc/devel/manual.html#sendmail">sendmail</a> command to a wrapper script.  Either use the <code>tee</code> command to
split the input message to both muttqt and your sendmail program, or copy the
input mail to a temporary file.  Here is a short example of the tee method: </p>

<pre><code>#!/bin/bash
tee &gt;(muttqt -f) | sendmail $*
</code></pre>

<p>Here is an example of the temp file method, useful if you want to do other things
with your email message before sending:</p>

<pre><code>#!/bin/sh -
muttqt='/usr/local/bin/muttqt -f'

sendmailbin='sendmail'

# save msg in file to re-use it for multiple tests
t=`mktemp -t mutt.XXXXXX` || exit 2
cat &gt; $t

# q all messages first
cat $t | ($muttqt)
cat $t | ${sendmailbin}
rm -f $t
</code></pre>

<p>The above script works on OS X.  One might need to change the <code>mktemp</code> command
to work on other OSes.  These scripts can be found in the <em>scripts</em> directory of
the source distribution, or in the <em>/usr/local/share/muttqt</em> directory.</p>

<h2>Other commands</h2>

<h3>Importing your lbdb sent addresses</h3>

<p>Run the following (pointing the command at the appropriate file):</p>

<pre><code>muttqt -i ~/.lbdb/m_inmail.list
</code></pre>

<h3>Exporting the sent SQL database</h3>

<p>Running the following will produce an <code>lbdb</code> compatible file:  </p>

<pre><code>muttqt -d output.txt
</code></pre>

<p>This file can be edited and reimported to <code>muttqt</code> in the same manner as an
<code>lbdb</code> sent address file.</p>

<h3>Editing and pruning the databse</h3>

<p>Running <code>muttqt --print-sent</code> will display every address in the sent mail
database, prefixed by the SQL row id.  If you would like to remove a specific
set of addresses, run <code>muttqt --remove-sent row_id</code>, where <em>row_id</em> are the row
ids of the addresses you would like to remove, separated by commas.</p>

<p>If you would like to remove all addresses last used before a certain date, run:</p>

<pre><code>muttqt --date-prune date
</code></pre>

<p>where <em>date</em> is in a YYYY-MM-DD format.</p>

<h2>Motivation</h2>

<p>I've used <a href="http://www.spinnaker.de/lbdb/">lbdb</a> for years, but began to have problems compiling the Mac OS X
Address Book tool since <a href="http://www.spinnaker.de/lbdb/">lbdb</a> is basically abandoned.  I went so far as to
actually pick it up, hack on it a bit, and put <a href="https://github.com/tgray/lbdb">my version</a> on github.
This is the version that can be found on the <a href="https://github.com/mxcl/homebrew">homebrew</a> packaging system for
Mac OS X.</p>

<p>So, I decided I could probably write a stripped down, easy-to-maintain version
in Python.  All I needed to do was write a small Objective C tool to interface
with the Mac OS X Address Book (<a href="https://github.com/tgray/contacts">done</a>) and then hack a bit at the
Python code.</p>

<h2>Developer Info</h2>

<p>muttqt is written by <a href="https://github.com/tgray">Tim Gray</a>.  It's obviously inspired by <a href="http://www.spinnaker.de/lbdb/">lbdb</a>.</p>

<p>The muttqt homepage can be located on github at <a href="http://tgray.github.io/muttqt/">http://tgray.github.io/muttqt/</a>.</p>

<h2>License</h2>

<p><code>muttqt</code> is released under an Apache License 2.0.  Please see the
<code>LICENSE.markdown</code> file included with the distribution.</p>
        </section>

        <footer>
          Muttqt is maintained by <a href="https://github.com/tgray">tgray</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-69332-5");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>
